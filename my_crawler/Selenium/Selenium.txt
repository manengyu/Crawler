https://www.ibm.com/developerworks/cn/java/j-lo-keyboard/
https://www.seleniumhq.org/

function selector(attribute, value) {
            var all = document.getElementsByTagName('*');
            for (var i = 0; i < all.length; i++) {
                if (all[i].getAttribute(attribute) == value) {
                    return all[i];
                }
            } }
js循环标签方法，取属性时若无此属性刚为null
var items = document.getElementsByTagName("a");
for(var i = 0;i<items.length;i++){
	if((items[i].getAttribute("onclick")!=null)&&items[i].getAttribute("onclick").indexOf("next")>0){
		var clickEvent = document.createEvent("HTMLEvents");
		clickEvent.initEvent("click",false,true);
		items[i].dispatchEvent(clickEvent);
		break;
	}
}


查找元素
element = self.br.find_element_by_xpath(u"//div[@class='live-search-wrap']/input").send_keys(u"wdzj2014")或
element = self.wait.until(ec.presence_of_element_located((By.XPATH, u"//ul[@class='nav']/li[7]/a")))或
js = u"""document.querySelectorAll('[change-type="invest"]')[0].getElementsByClassName('pagination-next  ')[0].getElementsByTagName('a')[0].click();"""
点击事件
element.click()或
action = ActionChains(self.br)
action.click(element).perform()或
js

js相关
查找元素一级一级往下找
无法通过标签识别，可循环根据属性值判断
点击事件在onclick属性中时，需要为标签添加点击事件，再用selenium点击方法点击，方可触发
将chromedriver.exe驱动程序放在chrome.exe同目录下，并加入至path变量中，便可运行selenium程序无需再指定驱动路径
getElementsByTagName()
getElementById()
driver.execute_script("window.open('http://www..com')")

phantomjs
http://npm.taobao.org/dist/phantomjs/

PyVirtualDisplay安装
http://blog.csdn.net/chengly0129/article/details/72229537
yum install Xvfb(需要)
yum -y install libXfont  
yum install xorg-x11-fonts* 
pip install pyvirtualdisplay(需要)

Chromedriver 
http://chromedriver.storage.googleapis.com/index.html
Chromium
https://people.centos.org/hughesjr/chromium/6/x86_64/RPMS/
chrome在linux安装困难(https://chrome.richardlloyd.org.uk/)
可用FireFox(http://seleniumhq.github.io/selenium/docs/api/java/org/openqa/selenium/firefox/FirefoxDriver.html)
或https://www.mozilla.org/en-US/firefox/channel/desktop/
或yum install firefox
geckodriver
https://github.com/mozilla/geckodriver/releases?after=v0.13.0

https://www.baidu.com/s?ie=utf-8&f=8&rsv_bp=1&rsv_idx=1&tn=baidu&wd=geckodriver%20unexceptedly%20exited&oq=geckodriver.exe&rsv_pq=95b32b0d00102776&rsv_t=1b91DUeCY7TbON4DY3P5yr8U1FF%2Fgd0nb1kPp0EbR9e%2B2Q02KB5gUsYmELE&rqlang=cn&rsv_enter=1&sug=firefoxdriver&inputT=13058&rsv_sug3=39&rsv_sug1=18&rsv_sug7=100&rsv_sug2=0&rsv_sug4=13058
https://stackoverflow.com/questions/40994493/service-geckodriver-unexpectedly-exited-status-code-was-2
contos.x86_64+Python2.7.3+selenium3.8.1/3.11.0+Firefox52.7.2+geckodriver0.16.0
from pyvirtualdisplay import Display
from selenium import webdriver
display = Display(visible=0, size=(800, 600))
display.start()
br = webdriver.Firefox()
br.get('http://www.python.org')
# br.add_cookie({'name': 'JSEESIONID', 'value': '07DA4C93F94FD619474B4C54D526110C'}) # add_cookie一定要在get url后
# br.switch_to.window(driver.window_handles[-1])
time.sleep(10)  # 要间歇否则获取cookie可能不全
cookie = [item["name"] + "=" + item["value"] for item in br.get_cookies()]
Cookie = ';'.join(item for item in cookie)
br.close()
display.stop()
请求不到数据时注意请求头，及其它数据
获取linux无界面浏览器请求头，可以写接口来接受查看请求数据
Mozilla/5.0 (X11; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0
标签在iframe下需先切换至iframe,再切回默认driver.switch_to.frame("frametj")，driver.switch_to.default_content()
弹框确认driver.switch_to.alert.accept()
等待标签显示driver.implicitly_wait(10)


def get_ch_va():
	from pyvirtualdisplay import Display
	from selenium import webdriver
	display = Display(visible=0, size=(800, 600))
	display.start()
	br = webdriver.Firefox()
	br.get('http://www.gsxt.gov.cn/SearchItemCaptcha')
	time.sleep(10)
	c_g = json.loads(re.findall(u"({.*?})", br.page_source)[0])
	api_url = "http://yingcan.geev.top/geetest/tzfresh?token=e16711f304c83696d3481806206b0c38&gt={0}&challenge={1}&refer="
	response = requests.get(url=api_url.format(c_g['gt'], c_g['challenge']), timeout=180)
	content = json.loads(response.content)
	br.quit()
	display.stop()
	return content['challenge'], content['validate']

selenium hub:
版本可用selenium/standalone-chrome:3.141.59-iron
报错：session deleted because of page crash from tab crashed，解决：挂载/dev/shm:/dev/shm
selenium/standalone-firefox:3.141.59（可避免因chrome被检测）

使用IE时安全设置里，安全模式要保持一致
chrome版本不同可能导致响应,cookie不一样

def get_driver(did):
    url_selenium = f"https://.com/selenium/wd/hub"
    chrome_options = webdriver.ChromeOptions()
    # chrome_options.add_argument("--auto-open-devtools-for-tabs")
    # chrome_options.add_argument("'--headless'")
    # chrome_options.add_experimental_option('excludeSwitches', ['enable-automation'])
    # chrome_options.add_argument("--unable-javascript")
    # chrome_options.add_experimental_option('debuggerAddress', '172.16.0.74:9222')
    # chrome_options.add_argument(f"Cookie=JSEESIONID8af3b805867b7405c8fb4a00ab5f11c3")
    chrome_options.add_argument("--auto-open-devtools-for-tabs")
    chrome_options.add_argument("--disable-blink-features=AutomationControlled") # 避免selenium屏蔽, driver.execute_script("return navigator.webdriver") undefine
    chrome_options.add_argument("disable-infobars")
    prefs = {
        # "download.prompt_for_download": True,
        # 'download.default_directory': os.getcwd(),
        # "plugins.always_open_pdf_externally": True,
        # 'profile.default_content_settings.popups': 0,  # 设置为0，禁止弹出窗口
        "profile.managed_default_content_settings.images": 1  # 禁止图片加载
    }
    chrome_options.add_experimental_option('prefs', prefs)
    driver = webdriver.Remote(command_executor=url_selenium, desired_capabilities=chrome_options.to_capabilities(), keep_alive=False)
    # time.sleep(5)
    # driver.get(url_report)
    return driver

driver.execute_script("Object.defineProperty(navigator, 'webdriver', {get: () => undefined})")

def get_driver(url):  # FireFox
    url_selenium = f"https://.com/selenium/wd/hub"
    from selenium.webdriver.common.desired_capabilities import DesiredCapabilities
    br = webdriver.Remote(command_executor=url_selenium, desired_capabilities=DesiredCapabilities.FIREFOX)
    br.get(url)
    return br

